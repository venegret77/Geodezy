@{
    Layout = null;
}

    <head>
        @Styles.Render("~/Content/css")
        @Scripts.Render("~/Content/js", "~/Content/vendor")
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover">

        <!-- favicons -->
        <link rel="apple-touch-icon" href="~/Content/img/favicon-apple.png">
        <link rel="icon" href="~/Content/img/favicon.png">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="~/Content/vendor/bootstrap-4.1.3/css/bootstrap.min.css">

        <!-- Material design icons CSS -->
        <link rel="stylesheet" href="~/Content/vendor/materializeicon/material-icons.css">

        <!-- aniamte CSS -->
        <link rel="stylesheet" href="~/Content/vendor/animatecss/animate.css">

        <!-- swiper carousel CSS -->
        <link rel="stylesheet" href="~/Content/vendor/swiper/css/swiper.min.css">

        <!-- daterange CSS -->
        <link rel="stylesheet" href="~/Content/vendor/bootstrap-daterangepicker-master/daterangepicker.css">

        <!-- footable CSS -->
        <link rel="stylesheet" href="~/Content/vendor/footable-bootstrap/css/footable.bootstrap.min.css">

        <!-- jvector map CSS -->
        <link rel="stylesheet" href="~/Content/vendor/jquery-jvectormap/jquery-jvectormap-2.0.3.css">

        <!-- app CSS -->
        <link id="theme" rel="stylesheet" href="~/Content/css/purplesidebar.css" type="text/css">

        <link rel="stylesheet" href="~/Content/vendor/chosen1.8/chosen.css">

    </head>
    <html>
    <body class="fixed-header sidebar-right-close sidebar-left-close">
        <!-- page loader -->
        <div class="loader justify-content-center pink-gradient">
            <div class="align-self-center text-center">
                <div class="logo-img-loader">
                    <img src="~/Content/img/loader-hole.png" alt="" class="logo-image">
                    <img src="~/Content/img/loader-bg.png" alt="" class="logo-bg-image">
                </div>
            </div>
        </div>
        <!-- page loader ends  -->

        <div class="wrapper">
            <!-- main header -->
            <header class="main-header">
                <div class="container-fluid">
                    <div class="row align-items-center">
                        <div class="col-auto px-0">
                            <div class="col-auto pl-15">
                                <a href="~/Home/Index/" class="btn success-gradient btn-sm rounded d-inline-block">На главную</a>
                            </div>
                        </div>
                        <div class="col px-0 text-right">
                            <div class="dropdown d-inline-block">
                                <a class="btn header-color-secondary dropdown-toggle username" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <figure class="userpic"><img src="~/Content/img/avatar.png" alt=""></figure>
                                    <h5 class="text-hide-xs">
                                        <small class="header-color-secondary">Добро пожаловать,</small>
                                        <span class="header-color-primary">@ViewBag.UserName</span>
                                    </h5>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right profile-dropdown" aria-labelledby="dropdownMenuLink">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <a href="~/Home/Profile/">
                                                <figure class="avatar avatar-120 mx-auto my-3">
                                                    <img src="~/Content/img/avatar.png" alt="">
                                                </figure>
                                                <h5 class="card-title mb-2 header-color-primary">@ViewBag.UserName</h5>
                                            </a>
                                            <h6 class="card-subtitle mb-3 header-color-secondary">@ViewBag.UserProfession</h6>
                                            <p class="card-text">@ViewBag.UserDescription</p>
                                        </div>
                                    </div>
                                    <div class="dropdown-divider m-0"></div>
                                    <a class="dropdown-item pink-gradient-active" href="~/Account/Logout/">
                                        <div class="row align-items-center">
                                            <div class="col">
                                                Выйти
                                            </div>
                                            <div class="col-auto">
                                                <div class="text-danger ml-2"><i class="material-icons vm">exit_to_app</i></div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </header>
            <div class="container mt-4 main-container">
                <div class="row">
                    @if (@Html.ValidationMessage("Err").ToString().Contains("Невозможно удалить бригаду")
                                            || @Html.ValidationMessage("Err").ToString().Contains("Невозможно удалить услугу, т.к. она используется"))
                    {
                        <div class="col-12 col-md-12">
                            <div class="alert alert-danger" role="alert">
                                @Html.ValidationMessage("Err");
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        </div>
                    }
                    @if (ViewBag.Brigade == null)
                    {
                        <div class="container mt-4 main-container">
                            <div class="row">
                                <div class="col-12 col-md-12">
                                    <div class="card mb-4 ">
                                        <div class="card-header p-0">
                                            <ul class="nav nav-tabs wizard-1" role="tablist">
                                                <li class="nav-item">
                                                    <a class="nav-link active success-gradient-active" id="tabhome123-tab" data-toggle="tab" href="#tabhome123" role="tab" aria-controls="tabhome123" aria-selected="true">
                                                        <span>Создание бригады</span>
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link success-gradient-active" id="tabhome333-tab" data-toggle="tab" href="#tabhome333" role="tab" aria-controls="tabhome333" aria-selected="false">
                                                        <span>Услуги</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body">
                                            <div class="tab-content">
                                                <div class="tab-pane fade show active" id="tabhome123" role="tabpanel" aria-labelledby="tabhome123-tab">

                                                    <div class="card-header success-gradient">
                                                        <h6 class="card-title">Создание новой бригады</h6>
                                                    </div>
                                                    <form method="post">
                                                        <div class="card-body">
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Наименование бригады</label></h6>
                                                                    <input type="text" name="name" class="form-control" placeholder="" required="" value="">
                                                                </div>
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Описание бригады</label></h6>
                                                                    <input type="text" name="description" class="form-control" placeholder="" value="">
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Выберите услуги, оказываемые бригадой</label></h6>
                                                                    <select name="slist" required class="cchosen-container-multi form-control" tabindex="2" multiple>
                                                                        @foreach (var s in ViewBag.Services)
                                                                        {
                                                                            <option value="@s.id">@s.name</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Выберите работников бригады</label></h6>
                                                                    <select name="ulist" required class="chosen-container-multi form-control" tabindex="2" multiple>
                                                                        @foreach (var w in ViewBag.Workers)
                                                                        {
                                                                            <option value="@w.id">@w.name</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6 right">
                                                                    <button type="submit" class="btn btn-primary success-gradient" name="action" value="createbr">Создать</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="tab-pane fade" id="tabhome333" role="tabpanel" aria-labelledby="tabhome333-tab">
                                                    <div class="card-header success-gradient">
                                                        <h6 class="card-title">Изменение списка услуг</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="col-sm-12">
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <form method="post">
                                                                        <div class="form-group row">
                                                                            <h6><label>Наименование услуги</label></h6>
                                                                            <input type="text" name="servicen" class="form-control" placeholder="" value="" required>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <h6><label>Описание услуги</label></h6>
                                                                            <input type="text" name="serviced" class="form-control" placeholder="" value="">
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-3 col-md-3">
                                                                            </div>
                                                                            <div class="col-lg-2 col-md-2">
                                                                                <button type="submit" class="btn btn-primary success-gradient" name="action" value="addserv">Добавить новую услугу</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                                <div class="col-lg-1 col-md-1">
                                                                </div>
                                                                <div class="col-lg-5 col-md-5">
                                                                    <form method="post">
                                                                        <div class="form-group row">
                                                                            <h6><label>Выберите услугу для удаления из списка ниже</label></h6>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-11 col-md-11">
                                                                                <select name="slist" required class="chosen-container-multi form-control" tabindex="2">
                                                                                    @foreach (var s in ViewBag.Services)
                                                                                    {
                                                                                        <option value="@s.id">@s.name</option>
                                                                                    }
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-2 col-md-2">
                                                                            </div>
                                                                            <div class="col-lg-2 col-md-2">
                                                                                <br />
                                                                                <button type="submit" class="btn btn-primary danger-gradient" name="action" value="deleteserv">Удалить выбранную услугу</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="container mt-4 main-container">
                            <div class="row">
                                <div class="col-12 col-md-12">
                                    <div class="card mb-4 ">
                                        <div class="card-header p-0">
                                            <ul class="nav nav-tabs wizard-1" role="tablist">
                                                <li class="nav-item">
                                                    <a class="nav-link active success-gradient-active" id="tab1-tab" data-toggle="tab" href="#tab1" role="tab" aria-controls="tab1" aria-selected="true">
                                                        <span>Моя бригада</span>
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link success-gradient-active" id="tab2-tab" data-toggle="tab" href="#tab2" role="tab" aria-controls="tab2" aria-selected="false">
                                                        <span>Изменение бригады</span>
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a class="nav-link success-gradient-active" id="tab3-tab" data-toggle="tab" href="#tab3" role="tab" aria-controls="tab3" aria-selected="false">
                                                        <span>Услуги</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="card-body">
                                            <div class="tab-content">
                                                <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">

                                                    <div class="card-header success-gradient">
                                                        <h6 class="card-title">Наименование: @ViewBag.Brigade.name</h6>
                                                        <h2 class="card-title">Описание: @ViewBag.Brigade.description</h2>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="form-group row">
                                                            <div class="col-lg-6 col-md-6">
                                                                <div class="card mb-4 ">
                                                                    <div class="card-header success-gradient">
                                                                        <div class="media">
                                                                            <div class="media-body">
                                                                                <h5 class="mt-1"><b>Список сотрудников</b></h5>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="card-body px-0 py-0">
                                                                        <ul class="list-group border-top border-bottom list-group-flush">
                                                                            @foreach (var u in ViewBag.ListOfUsers)
                                                                            {
                                                                                <li class="list-group-item">
                                                                                    <div class="media">
                                                                                        <figure class="avatar avatar-50 mr-3">
                                                                                            <img src="~/Content/img/avatar.png" alt="Generic placeholder image">
                                                                                        </figure>
                                                                                        <div class="media-body">
                                                                                            <h6 class="my-0 mt-1">@u.User.name</h6>
                                                                                            <p class="small">@u.User.Profession.name</p>
                                                                                            <p class="small">@u.User.description</p>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                            }
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-lg-6 col-md-6">
                                                                <div class="card mb-4 ">
                                                                    <div class="card-header success-gradient">
                                                                        <div class="media">
                                                                            <div class="media-body">
                                                                                <h5 class="mt-1"><b>Список услуг</b></h5>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="card-body px-0 py-0">
                                                                        <ul class="list-group border-top border-bottom list-group-flush">
                                                                            @foreach (var s in ViewBag.ListOfServices)
                                                                            {
                                                                                <li class="list-group-item">
                                                                                    <div class="media">
                                                                                        <div class="media-body">
                                                                                            <h6 class="my-0 mt-1">- @s.name</h6>
                                                                                        </div>
                                                                                    </div>
                                                                                </li>
                                                                            }
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group row">
                                                            <div class="col-lg-12 col-md-12">
                                                                <div class="card-header success-gradient">
                                                                    <h6 class="card-title">Задачи бригады</h6>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-group row">
                                                            <div class="col-lg-12 col-md-12">
                                                                <div class="row storyline col-lg-12 col-md-12">
                                                                    @for (int i = 0; i < ViewBag.Tasks.Count; i++)
                                                                    {
                                                                        string val = "left";
                                                                        if (i % 2 == 0)
                                                                        {
                                                                            val = "right";
                                                                        }
                                                                        else
                                                                        {
                                                                            val = "left";
                                                                        }
                                                                        if (ViewBag.Tasks[i].Task.dateend == null)
                                                                        {
                                                                            <div class="story-block @val">
                                                                                <form method="post">
                                                                                    <span class="timeline-bubble bg-danger"></span>
                                                                                    <div class="card mb-4">
                                                                                        <div class="card-header danger-gradient">
                                                                                            <h5 class="text-truncate w-100">Наименование: @ViewBag.Tasks[i].Task.name</h5>
                                                                                        </div>
                                                                                        <div class="card-body">
                                                                                            <p class="content-color-secondary">Описание: @ViewBag.Tasks[i].Task.description</p>
                                                                                            <p class="content-color-secondary text-danger">Статус: Не выполнен</p>
                                                                                        </div>
                                                                                        <div class="card-footer border-top no-gutters content-color-secondary">
                                                                                            <div class="row m-md-6">
                                                                                                <i class="material-icons vm content-color-primary">date_range</i>Дата с @ViewBag.Tasks[i].Task.datestart.ToShortDateString()
                                                                                            </div>
                                                                                            @if (@ViewBag.Tasks[i].Task.datestart < DateTime.Now)
                                                                                            {
                                                                                            <div class="row justify-content-center m-lg-3">
                                                                                                <input type="text" hidden value="@ViewBag.Tasks[i].Task.id" name="tid"/>
                                                                                                <button type="submit" class="btn btn-primary success-gradient" name="action" value="readytask">Подтвердить выполнение</button>
                                                                                            </div>
                                                                                            }
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                        }
                                                                        else
                                                                        {
                                                                            <div class="story-block @val">
                                                                                <form method="post">
                                                                                    <span class="timeline-bubble bg-success"></span>
                                                                                    <div class="card mb-4">
                                                                                        <div class="card-header success-gradient">
                                                                                            <h5 class="text-truncate w-100">Наименование: @ViewBag.Tasks[i].Task.name</h5>
                                                                                        </div>
                                                                                        <div class="card-body">
                                                                                            <p class="content-color-secondary">Описание: @ViewBag.Tasks[i].Task.description</p>
                                                                                            <p class="content-color-secondary text-success">Статус: Выполнен</p>
                                                                                        </div>
                                                                                        <div class="card-footer border-top no-gutters content-color-secondary ">
                                                                                            <div class="row m-md-6">
                                                                                                <i class="material-icons vm content-color-primary">date_range</i>Дата с @ViewBag.Tasks[i].Task.datestart.ToShortDateString() по @ViewBag.Tasks[i].Task.dateend.ToShortDateString()
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                        }
                                                                    }
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
                                                    <div class="card-header success-gradient">
                                                        <h6 class="card-title">Изменение текущей бригады</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <form method="post">
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Наименование бригады</label></h6>
                                                                    <input type="text" name="name" class="form-control" placeholder="" required="" value="@ViewBag.Brigade.name">
                                                                </div>
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Описание бригады</label></h6>
                                                                    <input type="text" name="description" class="form-control" placeholder="" value="@ViewBag.Brigade.description">
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Выберите услуги, оказываемые бригадой</label></h6>
                                                                    <select name="slist" required class="chosen-container-multi form-control" tabindex="2" multiple>
                                                                        @foreach (var s in ViewBag.Services)
                                                                        {
                                                                            <option value="@s.id">@s.name</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                                <div class="col-lg-6 col-md-6">
                                                                    <h6><label>Выберите работников бригады</label></h6>
                                                                    <select name="ulist" required class="chosen-container-multi form-control" tabindex="2" multiple>
                                                                        <option disabled>Действующие работники</option>
                                                                        @foreach (var u in ViewBag.ListOfUsers)
                                                                        {
                                                                            <option selected value="@u.User.id" ac>@u.User.name</option>
                                                                        }
                                                                        <option disabled>Свободные работники</option>
                                                                        @foreach (var w in ViewBag.Workers)
                                                                        {
                                                                            <option value="@w.id">@w.name</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="form-group row">
                                                                <div class="col-lg-2 col-md-2">
                                                                    <button type="submit" class="btn btn-primary success-gradient" name="action" value="changebr">Изменить</button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                        <form method="post">
                                                            <button type="submit" class="btn btn-primary danger-gradient" name="action" value="deletebr">Удалить бригаду</button>
                                                        </form>
                                                    </div>
                                                </div>
                                                <div class="tab-pane fade" id="tab3" role="tabpanel" aria-labelledby="tab3-tab">
                                                    <div class="card-header success-gradient">
                                                        <h6 class="card-title">Изменение списка услуг</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="col-sm-12">
                                                            <div class="form-group row">
                                                                <div class="col-lg-6 col-md-6">
                                                                    <form method="post">
                                                                        <div class="form-group row">
                                                                            <h6><label>Наименование услуги</label></h6>
                                                                            <input type="text" name="servicen" class="form-control" placeholder="" value="" required>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <h6><label>Описание услуги</label></h6>
                                                                            <input type="text" name="serviced" class="form-control" placeholder="" value="">
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-3 col-md-3">
                                                                            </div>
                                                                            <div class="col-lg-2 col-md-2">
                                                                                <button type="submit" class="btn btn-primary success-gradient" name="action" value="addserv">Добавить новую услугу</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                                <div class="col-lg-1 col-md-1">
                                                                </div>
                                                                <div class="col-lg-5 col-md-5">
                                                                    <form method="post">
                                                                        <div class="form-group row">
                                                                            <h6><label>Выберите услугу для удаления из списка ниже</label></h6>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-11 col-md-11">
                                                                                <select name="slist" required class="chosen-container-multi form-control" tabindex="2">
                                                                                    @foreach (var s in ViewBag.Services)
                                                                                    {
                                                                                        <option value="@s.id">@s.name</option>
                                                                                    }
                                                                                </select>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group row">
                                                                            <div class="col-lg-2 col-md-2">
                                                                            </div>
                                                                            <div class="col-lg-2 col-md-2">
                                                                                <br />
                                                                                <button type="submit" class="btn btn-primary danger-gradient" name="action" value="deleteserv">Удалить выбранную услугу</button>
                                                                            </div>
                                                                        </div>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- page specific script -->
        <script src="~/Content/js/jquery-3.2.1.min.js"></script>
        <script src="~/Content/js/popper.min.js"></script>
        <script src="~/Content/vendor/bootstrap-4.1.3/js/bootstrap.min.js"></script>
        <script src="~/Content/vendor/cookie/jquery.cookie.js"></script>
        <script src="~/Content/vendor/sparklines/jquery.sparkline.min.js"></script>
        <script src="~/Content/vendor/circle-progress/circle-progress.min.js"></script>
        <script src="~/Content/vendor/swiper/js/swiper.min.js"></script>
        <script src="~/Content/vendor/chartjs/Chart.bundle.min.js"></script>
        <script src="~/Content/vendor/chartjs/utils.js"></script>
        <script src="~/Content/vendor/footable-bootstrap/js/footable.min.js"></script>
        <script src="~/Content/vendor/bootstrap-daterangepicker-master/moment.js"></script>
        <script src="~/Content/vendor/bootstrap-daterangepicker-master/daterangepicker.js"></script>
        <script src="~/Content/vendor/jquery-jvectormap/jquery-jvectormap.js"></script>
        <script src="~/Content/vendor/jquery-jvectormap/jquery-jvectormap-world-mill-en.js"></script>
        <script src="~/Content/vendor/sortable/Sortable.js"></script>
        <script src="~/Content/js/main.js"></script>
        <script src="~/Content/js/dragable_sortable.js"></script>
        <script src="~/Content/vendor/chosen1.8/chosen.jquery.min.js"></script>
        <script>
            "use script";
            $('.chosen_select').chosen();
        </script>

        <!-- page specific script -->
    </body>
    </html>
  